---

title: 速通 Git
categories: [计算机, 工具]
tags: [git]
authors: [badbadyi]
---

## 简介

### Git 是什么

Git 是一个分布式版本控制工具，你可以用 Git 来存储你的文件，跟踪文件历史，合并更改，亦或是在错误发生时回滚到之前的版本。

### Git 的特点

- 本地执行

  绝大多数 Git 操作都可以在本地直接执行而无需借助网络，这使得 Git 执行迅速且可以离线使用

- 完整性保证

  你无法在 Git 不知情的情况下修改 Git 仓库下的文件内容或是路径结构

- 一般只添加数据

  这使得你可以更轻易的恢复你的数据，而无需担心因为失误操作导致文件损毁

## 安装 Git

### Windows

在 Windows 上安装 Git 可以选择 [Git for Windows](https://gitforwindows.org/)

Git for Windows 有完善的图形化安装界面，如果不需要额外配置，一路下一步即可以完成安装

### 验证安装

打开命令行界面，执行 `git -v` 来查询安装 Git 的版本，如果获得类似于 `git version 2.43.0.windows.1` 的返回值，则说明安装成功

## 必要的配置

### Git 配置简介

Git 通过自带的 `git config` 命令行工具来管理 Git 配置

执行 `git config --list --show-origin` 命令来获取你所有的配置以及其所在的文件路径

其中位于 `.../etc/gitconfig` 路径下的为全局配置，对于 Windows 系统 `...` 指代 Git 安装位置。

其中位于 `~/.gitconfig` 路径下的为用户配置，其中 `~` 指代用户文件夹

每个仓库路径下的 `config` 文件（即 `.git/config`）为仓库配置，仅针对当前 Git 仓库

三个层次的配置文件，仓库会覆盖用户，用户会覆盖全局配置

### 首次 commit 前的配置

Git 每次 commit 都需要用到用户名和邮箱地址，因此你需要优先配置这两项

配置用户名，将双引号内的字符替换为你的用户名

```sh
git config --global user.name "your name here"
```

配置邮箱，将示例邮箱地址替换为你的邮箱

```sh
git config --global user.email xxxxx@example.com
```

其中 `--global` 参数表示修改全局配置，这个系统上的所有操作都可以用到该配置，避免了使用新仓库时重新配置的麻烦

### 验证配置

通过命令 `git config --list` 来检查你的配置

通过命令 `git config <key>` 来检查特定键值的配置，例如 `git config user.name`

## 基础使用

### Git 仓库

一个 Git 仓库本质上就是一个带有 `.git` 文件夹的路径，该路径下的的文件受到 Git 工具的监控和管理，而 `.git` 文件夹用于来存放管理文件快照和配置文件

### 获得一个仓库

你需要获得一个 Git 仓库来尝试各种 Git 操作

- 本地建立

  通过命令 `git init` 来在当前路径建立一个 Git 仓库（看上去就是生成了一个 `.git` 文件夹）

  对于空文件夹，这样做已经足够了，但是如果你在一个已经有文件的文件夹下按照该方式建立仓库，你需要使用 `add` 指令来添加你需要追踪的文件，然后使用 `commit` 指令进行第一次提交

  ```sh
  git add *.c
  git add README.md
  git commit -m "init my project"
  ```

- 远程克隆

  你还可以通过命令 `git clone` 来获取一个现成的仓库，下面以本博客源代码为例

  通过如下命令克隆一个仓库到如下路径 `当前路径/badbadyi.github.io.git`，其中克隆的结果路径为项目的仓库名

  ```sh
  git clone git@github.com:badbadyi/badbadyi.github.io.git
  ```

  通过额外参数来指定克隆的目标路径 `当前路径/project` ，project 为自定义的路径

  ```sh
  git clone git@github.com:badbadyi/badbadyi.github.io.git project
  ```

### 文件的状态

前面提到，Git 可以记录仓库中文件的变化，你可以通过命令 `git status` 来检查仓库文件变化

这个命令会返回如下信息

- **当前所在的分支**，例如 `On branch master`，说明你当前所在分支为 `master`

- **提交信息**

  - 还从未有过提交

     `No commits yet`

  - 自上次提交后没有改动

    `nothing to commit, working tree clean` 

  - 还未暂存的改动等待提交

     `Changes not staged for commit`

    ```
    Changes not staged for commit:
      (use "git add <file>..." to update what will be committed)
      (use "git restore <file>..." to discard changes in working directory)
            modified:   "\346\265\213\350\257\2251.txt"
    ```
    
  - 新的改动等待提交（新文件或者已暂存的变化文件）

     `changes to be commited` 

    ```
    Changes to be committed:
      (use "git rm --cached <file>..." to unstage)
            new file:   "\346\265\213\350\257\2251.txt"
    ```

- **未追踪文件**

    当你的仓库中有没有追踪的文件时，会出现类似如下信息
    
    ```
    Untracked files:
      (use "git add <file>..." to include in what will be committed)
            "\346\265\213\350\257\2251.txt"
    
    nothing added to commit but untracked files present (use "git add" to track)
    ```
    
    如果你想要追踪该文件，你应该使用 `git add` 命令来添加它

### 暂存文件

当一个被追踪文件被**改动**后，该文件处于**未被暂存的状态**，运行 `git status` 得到类似如下输出

```
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   "\346\265\213\350\257\2251.txt"
```

如果你需要提交一个这样的文件，你可以先使用 `git add <filename>` 命令将其暂存（和添加追踪文件同一个命令）， `<filename>` 指代你需要暂存的文件

你的下一次提交会一并提交你的所有暂存状态的文件

*附：如果你在暂存一个文件之后再对其进行改动，暂存区的文件仍为你使用 `add` 指令时的版本。如果你希望暂存最新的版本，你应该再使用一次 `git add`* 

### 提交更新

使用 `git status` 来确保你需要提交的改动都已经被暂存

然后使用 `git commit` 指令来提交更新

这个指令会让你跳转到你配置的编辑器，第一行为空行用于你编写你的提交信息，后面的行都被注释，记录了你这次将要提交的相关信息，在完成提交时他们会被舍弃

你可以为命令加上 `-m` 参数来直接编辑提交信息，而无需进入编辑器，例如

```sh
git commit -m "my first commit"
```

提交成功后会有类似如下信息

```
[master 1d169b8] my first commit
 1 file changed, 1 insertion(+), 1 deletion(-)
```

你还可以通过 `-a` 参数来跳过暂存环节

```sh
git commit -a -m "my first commit"
```

### 忽略文件

有时候你希望 Git 不管理一些文件，又不希望它一直出现在未追踪的文件列表里。例如项目中的日志文件或者编译中的临时文件。

你可以通过编辑 `.gitignore` 文件来忽略他们

该文件以行为单位读取，以 `#` 开头的行会被忽略，下面是一个简单的例子

```
# 忽略 .o 后缀文件 *为通配符
*.o

# 不忽略该文件，即使它在前面被标记为忽略
!dont_ignore.o

# 只忽略当前目录下的 ignore
/ignore

# 忽略所有目录下的该文件夹
build/

# 忽略 doc/notes.txt，但不忽略 doc/server/arch.txt
doc/*.txt

# 忽略 doc/ 目录及其所有子目录下的 .pdf 文件
doc/**/*.pdf
```

根目录下的 `.gitignore` 文件会被应用到所有的目录下，而子目录也可以有该文件，被应用到子目录下的所有文件夹

详细的用法 [github/gitignore: A collection of useful .gitignore templates](https://github.com/github/gitignore)

